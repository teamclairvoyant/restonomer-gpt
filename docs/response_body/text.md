# Text

The restonomer request object can return the API response of `Text` type of various formats.
Supported text formats are:

* CSV
* JSON
* XML

## CSV

Restonomer can parse the api response of text type in CSV format. User need to configure the checkpoint in below format:

```hocon
name = "checkpoint_csv_response_dataframe_converter"

data = {
  data-request = {
    url = "http://localhost:8080/csv-response-converter"
  }

  data-response = {
    body = {
      type = "Text"
      text-format = {
        type = "CSVTextFormat"
        sep = ";"
      }
    }
    persistence = {
      type = "LocalFileSystem"
      file-format = "csv"
      file-path = "/tmp/converter"
    }
  }
}
```

Just like `sep`, user can configure below other properties for CSV text format that will help restonomer for parsing:

| Parameter Name                |        Default Value        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| :---------------------------- | :-------------------------: | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| charToEscapeQuoteEscaping     |              \              | Sets a single character used for escaping the escape for the quote character.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| columnNameOfCorruptRecord     |       _corrupt_record       | Allows renaming the new field having malformed string created by PERMISSIVE mode. <br/>This overrides `spark.sql.columnNameOfCorruptRecord`.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| comment                       |              #              | Sets a single character used for skipping lines beginning with this character.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| dateFormat                    |         yyyy-MM-dd          | Sets the string that indicates a date format.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| emptyValue                    |      "" (empty string)      | Sets the string representation of an empty value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| enableDateTimeParsingFallback |            true             | Allows falling back to the backward compatible (Spark 1.x and 2.0) behavior of parsing dates and timestamps <br/>if values do not match the set patterns.                                                                                                                                                                                                                                                                                                                                                                                                               |
| encoding                      |            UTF-8            | Decodes the CSV files by the given encoding type.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| enforceSchema                 |            true             | If it is set to true, the specified or inferred schema will be forcibly applied to datasource files, and headers in CSV files will be ignored. <br/>If the option is set to false, the schema will be validated against all headers in CSV files in the case when the header option is set to true. <br/>Field names in the schema and column names in CSV headers are checked by their positions taking into account spark.sql.caseSensitive. <br/>Though the default value is true, it is recommended to disable the enforceSchema option to avoid incorrect results. |
| escape                        |              \              | Sets a single character used for escaping quotes inside an already quoted value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| header                        |            true             | Boolean flag to tell whether csv text contains header names or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| inferSchema                   |            true             | Infers the input schema automatically from data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ignoreLeadingWhiteSpace       |            false            | A flag indicating whether or not leading whitespaces from values being read should be skipped.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ignoreTrailingWhiteSpace      |            false            | A flag indicating whether or not trailing whitespaces from values being read should be skipped.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| lineSep                       |             \n              | Defines the line separator that should be used for parsing. Maximum length is 1 character.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| locale                        |            en-US            | Sets a locale as language tag in IETF BCP 47 format. For instance, this is used while parsing dates and timestamps.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| maxCharsPerColumn             |             -1              | Defines the maximum number of characters allowed for any given value being read.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  |
| maxColumns                    |            20480            | Defines a hard limit of how many columns a record can have.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  |
| mode                          |          FAILFAST           | Allows a mode for dealing with corrupt records during parsing. Allowed values are PERMISSIVE, DROPMALFORMED and FAILFAST.                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| multiLine                     |            false            | Parse one record, which may span multiple lines, per file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| nanValue                      |             NaN             | Sets the string representation of a non-number value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| negativeInf                   |            -Inf             | Sets the string representation of a negative infinity value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| nullValue                     |            null             | Sets the string representation of a null value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| positiveInf                   |             Inf             | Sets the string representation of a positive infinity value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| preferDate                    |            true             | During schema inference (inferSchema), attempts to infer string columns that contain dates as Date if the values satisfy the dateFormat option or default date format. <br/>For columns that contain a mixture of dates and timestamps, try inferring them as TimestampType if timestamp format not specified, otherwise infer them as StringType.                                                                                                                                                                                                                      |
| quote                         |              "              | Sets a single character used for escaping quoted values where the separator can be part of the value. <br/>For reading, if you would like to turn off quotations, you need to set not null but an empty string.                                                                                                                                                                                                                                                                                                                                                         |
| recordSep                     |             \n              | Delimiter by which rows are separated in a csv text.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| samplingRatio                 |             1.0             | Defines fraction of rows used for schema inferring.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| sep                           |              ,              | Delimiter by which fields in a row are separated in a csv text.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| timestampFormat               |     yyyy-MM-dd HH:mm:ss     | Sets the string that indicates a timestamp format.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| timestampNTZFormat            | yyyy-MM-dd'T'HH:mm:ss[.SSS] | Sets the string that indicates a timestamp without timezone format.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| unescapedQuoteHandling        |      STOP_AT_DELIMITER      | Defines how the CsvParser will handle values with unescaped quotes. <br/> Allowed values are STOP_AT_CLOSING_QUOTE, BACK_TO_DELIMITER, STOP_AT_DELIMITER, SKIP_VALUE, RAISE_ERROR                                                                                                                                                                                                                                                                                                                                                                                       |


## JSON

Restonomer can parse the api response of text type in JSON format. User need to configure the checkpoint in below format:

```hocon
name = "checkpoint_json_response_dataframe_converter"

data = {
  data-request = {
    url = "http://localhost:8080/json-response-converter"
  }

  data-response = {
    body = {
      type = "Text"
      text-format = {
        type = "JSONTextFormat"
        primitives-as-string = true
      }
    }
    persistence = {
      type = "LocalFileSystem"
      file-format = "csv"
      file-path = "/tmp/converter"
    }
  }
}
```

Just like `primitives-as-string`, user can configure below other properties for JSON text format that will help restonomer for parsing:

| Parameter Name                     |        Default Value        | Description                                                                                                                                                |
| :--------------------------------- | :-------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------- |
| allowBackslashEscapingAnyCharacter |            false            | Allows accepting quoting of all character using backslash quoting mechanism.                                                                               |
| allowComments                      |            false            | Ignores Java/C++ style comment in JSON records.                                                                                                            |
| allowNonNumericNumbers             |            true             | Allows JSON parser to recognize set of “Not-a-Number” (NaN) tokens as legal floating number values.                                                        |
| allowNumericLeadingZeros           |            false            | Allows leading zeros in numbers (e.g. 00012).                                                                                                              |
| allowSingleQuotes                  |            true             | Allows single quotes in addition to double quotes.                                                                                                         |
| allowUnquotedControlChars          |            false            | Allows JSON Strings to contain unquoted control characters <br/>(ASCII characters with value less than 32, including tab and line feed characters) or not. |
| allowUnquotedFieldNames            |            false            | Allows unquoted JSON field names.                                                                                                                          |
| columnNameOfCorruptRecord          |       _corrupt_record       | Allows renaming the new field having malformed string created by PERMISSIVE mode. This overrides spark.sql.columnNameOfCorruptRecord.                      |
| dataColumnName                     |            None             | The name of column that actually contains dataset. If present, the api will only parse dataset of this column to dataframe.                                |
| dateFormat                         |         yyyy-MM-dd          | Sets the string that indicates a date format.                                                                                                              |
| dropFieldIfAllNull                 |            false            | Whether to ignore column of all null values or empty array during schema inference.                                                                        |
| enableDateTimeParsingFallback      |            true             | Allows falling back to the backward compatible (Spark 1.x and 2.0) behavior of parsing dates and timestamps <br/>if values do not match the set patterns.  |
| encoding                           |            UTF-8            | Decodes the JSON files by the given encoding type.                                                                                                         |
| inferSchema                        |            true             | Infers the input schema automatically from data.                                                                                                           |
| lineSep                            |             \n              | Defines the line separator that should be used for parsing. Maximum length is 1 character.                                                                 |
| locale                             |            en-US            | Sets a locale as language tag in IETF BCP 47 format. For instance, this is used while parsing dates and timestamps.                                        |
| mode                               |          FAILFAST           | Allows a mode for dealing with corrupt records during parsing. Allowed values are PERMISSIVE, DROPMALFORMED and FAILFAST.                                  |
| multiLine                          |            false            | Parse one record, which may span multiple lines, per file.                                                                                                 |
| prefersDecimal                     |            false            | Infers all floating-point values as a decimal type. If the values do not fit in decimal, then it infers them as doubles.                                   |
| primitivesAsString                 |            false            | Infers all primitive values as a string type.                                                                                                              |
| samplingRatio                      |             1.0             | Defines fraction of rows used for schema inferring.                                                                                                        |
| timestampFormat                    |     yyyy-MM-dd HH:mm:ss     | Sets the string that indicates a timestamp format.                                                                                                         |
| timestampNTZFormat                 | yyyy-MM-dd'T'HH:mm:ss[.SSS] | Sets the string that indicates a timestamp without timezone format.                                                                                        |
| timeZone                           |             UTC             | Sets the string that indicates a time zone ID to be used to format timestamps in the JSON datasources or partition values.                                 |


## XML

Restonomer can parse the api response of text type in XML format. User need to configure the checkpoint in below format:

```hocon
name = "checkpoint_xml_response_dataframe_converter"

data = {
  data-request = {
    url = "http://localhost:8080/xml-response-converter"
  }

  data-response = {
    body = {
      type = "Text"
      text-format = {
        type = "XMLTextFormat"
        row-tag = "ROW"
      }
    }
    persistence = {
      type = "LocalFileSystem"
      file-format = "csv"
      file-path = "/tmp/converter"
    }
  }
}
```

Just like `row-tag`, user can configure below other properties for XML text format that will help restonomer for parsing:

| Parameter Name            |    Default Value    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :------------------------ | :-----------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| attributePrefix           |          _          | The prefix for attributes so that we can differentiate attributes and elements.                                                                                                                                                                                                                                                                                                                                                               |
| charset                   |        UTF-8        | Defaults to 'UTF-8' but can be set to other valid charset names.                                                                                                                                                                                                                                                                                                                                                                              |
| columnNameOfCorruptRecord |   _corrupt_record   | Allows renaming the new field having malformed string created by PERMISSIVE mode. This overrides spark.sql.columnNameOfCorruptRecord.                                                                                                                                                                                                                                                                                                         |
| dateFormat                |     yyyy-MM-dd      | Sets the string that indicates a date format.                                                                                                                                                                                                                                                                                                                                                                                                 |
| excludeAttribute          |        false        | Whether you want to exclude attributes in elements or not.                                                                                                                                                                                                                                                                                                                                                                                    |
| ignoreSurroundingSpaces   |        false        | Defines whether or not surrounding whitespaces from values being read should be skipped.                                                                                                                                                                                                                                                                                                                                                      |
| ignoreNamespace           |        false        | If true, namespaces prefixes on XML elements and attributes are ignored. <br/>Note that, at the moment, namespaces cannot be ignored on the rowTag element, only its children. <br/>Note that XML parsing is in general not namespace-aware even if false.                                                                               |
| inferSchema               |        true         | Infers the input schema automatically from data.                                                                                                                                                                                                                                                                                                                                                                                              |
| mode                      |      FAILFAST       | Allows a mode for dealing with corrupt records during parsing. Allowed values are PERMISSIVE, DROPMALFORMED and FAILFAST.                                                                                                                                                                                                                                                                                                                     |
| nullValue                 |        null         | The value to read as null value                                                                                                                                                                                                                                                                                                                                                                                                               |
| rowTag                    |         row         | The row tag of your xml files to treat as a row.                                                                                                                                                                                                                                                                                              |
| samplingRatio             |         1.0         | Defines fraction of rows used for schema inferring.                                                                                                                                                                                                                                                                                                                                                                                           |
| timestampFormat           | yyyy-MM-dd HH:mm:ss | Sets the string that indicates a timestamp format.                                                                                                                                                                                                                                                                                                                                                                                            |
| valueTag                  |       _VALUE        | The tag used for the value when there are attributes in the element having no child.                                                                                                                                                                                                                                                                                                                                                          |
| wildcardColName           |       xs_any        | Name of a column existing in the provided schema which is interpreted as a 'wildcard'. It must have type string or array of strings. <br/>It will match any XML child element that is not otherwise matched by the schema. The XML of the child becomes the string value of the column. <br/>If an array, then all unmatched elements will be returned as an array of strings. As its name implies, it is meant to emulate XSD's xs:any type. |
